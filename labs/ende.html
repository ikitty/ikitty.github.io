<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
<style>
p { margin : .8em 0; font-size : 14px; }
* {box-sizing:border-box;}
input[type="submit"] { border: 1px solid #c1c1c1; border-radius: 4px; padding: 3px 10px; background-color: #fff; }
textarea { border : 1px solid #ccc; resize : none; height : 240px; padding : 5px 10px; } 
.hide { display : none; }
textarea { width : 100%; max-width : 540px; }

@media(max-width:414px){
    .form_ge {display:none;}
}
</style>
</head>
<body>
<form id="form" onsubmit="return false;">
    <div  class="form_ge">
        <p><textarea name="code" id="code"></textarea></p>
        <p><input class="btn" type="submit" value="GeItDo!" id="generate"></p>
        <div id="geImg" class="hide">
            <p><img id="pic" /></p>
            <a id="download" class="btn" download="sfa.png" href="#">down</a>
        </div>
    </div>

    <p style="background:#eee"><input type="file" id="select"></p>
    <p><textarea name="code" id="code2"></textarea></p>
</form>

<script>var Encode=function(b){var e=b.length;if(0!==e%8){for(var a="",c=0;c<8-e%8;c++)a+="\x00";b=a+b}e=[];for(a=0;a<b.length;a+=8)for(c=0;7>c;c++)e.push((b.charCodeAt(a+c)<<c+1&255)+(b.charCodeAt(a+c+1)>>6-c));b=Math.ceil(e.length/3);a=Math.ceil(Math.sqrt(b));a=[a,Math.ceil(b/a)];b=a[0];a=a[1];c=document.createElement("canvas");c.width=b;c.height=a;for(var d=c.getContext("2d"),f=d.createImageData(b,a),m=0,g=0;g<a;g++)for(var h=0;h<b;h++){for(var l=4*(g*b+h),k=0;3>k;k++)f.data[l+k]=e[m++];f.data[l+3]=255}d.putImageData(f,0,0);return c.toDataURL()};var Decode=function(b){var e;e=[];var a=b.width,c=b.height,d=document.createElement("canvas");d.width=a;d.height=c;d=d.getContext("2d");d.drawImage(b,0,0);b=d.getImageData(0,0,a,c);for(d=0;d<a*c*4;d+=4)[].push.apply(e,[].slice.call(b.data,d,d+3));for(a=e.length-1;0===e[a];)e=e.slice(0,a),a--;a="";for(c=0;c<e.length;c+=7)for(b=0;8>b;b++)d=((0==b?0:e[c+b-1])<<7-b&127)+((7==b?0:e[c+b])>>b+1),a+=0==d?"":String.fromCharCode(d);return a}</script>

<script>
    document.querySelector('#generate').addEventListener('click', function(e) {
        e.preventDefault();
        var str = document.querySelector('#code').value;
        var dataUri = Encode(str);
        document.querySelector('#pic').src = dataUri;
        document.querySelector('#download').href = dataUri;
        document.getElementById('geImg').className = ''
    }, false);

    document.querySelector('#select').addEventListener('change', function(e) {
        e.preventDefault();
        var f = this.files[0];
        var fr = new FileReader();

        fr.onload = function() {
            var img = new Image;
            img.onload = function() {
                document.querySelector('#code2').value = Decode(img);
            };
            img.src = this.result;
        };
        fr.readAsDataURL(f); 
    }, false);
</script>
</body>
</html>

