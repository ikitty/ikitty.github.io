<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="renderer" content="webkit" />
<meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="robots" content="all" />
<style type="text/css" media="screen">
    * {margin:0;padding:0;list-style:none;}
</style>
<title>JS async test</title>
</head>
<body>
    <h1 class="">async</h1>

<script>
    function sleep (v) {
        return new Promise(res=>{
            setTimeout(res, v);
        }) ;
    }
    function timer (time) {
        return new Promise((res, rej)=>{
            if (!time ) {
                rej(new Error('no arguments'))
            }
            setTimeout(()=>{
                res('after ' + time + ' ms, done')
            }, time);
        }) ;
    }

    //循环中await也是串行
    (async function (argument) {
        return  ;
        for (var i = 0; i < 10; i++) {
            await sleep(500)
            console.log(i) ;
        };
    })(); 

    //串行,前面出错后，后面的代码不会执行

    (async function (argument) {
        return  ;
        var a = await timer()
        console.log(a) ;
        var b = await timer(2000)
        console.log(b) ;
    })(); 

    //all 并发
    (async function (argument) {
        //一个reject，立即reject
        var p = [timer(1000), timer()]
        var ret = await Promise.all(p)
        console.log(ret) ;
    })().catch(err=>{
        console.log(err) ;
    }); 
</script>
</body>
</html>
