<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<title>DEMO</title>
<style type="text/css" media="screen">
* {margin:0;padding:0;list-style:none;}
    
body {background-color:#000;}
.alex_line {display:block;margin:20px auto 0;width:414px;height:600px;background-image:url(http://ossweb-img.qq.com/images/n/act/a20151116show/mobile_bg.jpg);background-size:cover;border:1px solid #000;}
</style>
</head>
<body>


<canvas id="alexLine" class="alex_line"></canvas>

<script type="text/javascript">
    (function () {
        window.RAF= window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    function (cb) {
                        window.setTimeout(cb, 1000/60);
                    };
    })();

    var xLine = function () {
        this.init.apply(this, arguments);
    };  

    xLine.prototype = {
        config: {
            name:'alex'
            ,'age': 18
        }
        ,init: function (arg) {
            //动态在this上写入的对象是实例私有的，而this.config是指向prototype中的，各个实例共享

            //pre setting
            this.isNice = 1 ;
            this.isBeauty = 1 ;

            //custom config
            this.cfg = {};
            for (var i in arg) {
                if (arg.hasOwnProperty(i)) {
                    this.cfg[i] = arg[i];
                }
            }
        }
        ,say: function () {
            console.log(this.cfg) ;
        }
    };

    //Canvas Base Class
    var alexCanvas = function () { this.init.apply(this, arguments); };  
    alexCanvas.prototype = {
        init: function (arg) {
            this.c = null;

            //custom config
            this.cfg = {
                id: 'alexCanvas'
                ,width:200
                ,height:200
                ,cap: 'round'
                ,join: 'round'
                ,lineWidth: 3
                ,fillStyle: 'rgba(50, 160, 255, 0.8)'
                ,strokeStyle: 'rgba(180,180,180, 0.6)'
            };
            for (var i in arg) {
                if (arg.hasOwnProperty(i)) {
                    this.cfg[i] = arg[i] ;
                }
            }

            var D = this.cfg ;
            var el = document.getElementById(D.id);
            el.setAttribute('width', D.width) ;
            el.setAttribute('height', D.height) ;

            this.c = el.getContext('2d');
            this.setDrawStyle();
        }
        ,render: function (aPath) {
            var c = this.c ,
                me = this ;

            me.clear();
            c.save();
            c.beginPath();  

            for (var i = 0, k = null; k = aPath[i] ; i++ ) {
                c[k.type] && (c[k.type].apply(c, k.v || []));
            }
            c.closePath();
            c.fill();         
            c.stroke();
            
            c.restore();
        }

        ,clear: function () {
            this.c.clearRect(0,0, this.cfg.width, this.cfg.height);
        }

        ,setDrawStyle: function (style) {
            var c = this.c ,
                config = this.cfg ;

            c.lineCap = config.cap;
            c.lineJoin = config.join;
            c.lineWidth = config.lineWidth;
            c.fillStyle = config.fillStyle ;
            c.strokeStyle = config.strokeStyle ;
        }
    };

    //custom canvas
    var myCanvas = new alexCanvas({
        id: 'alexLine'
        ,width: 414
        ,height: 600
    });
    myCanvas.renderAnim = function () {
        var me =this;

        var lastPoint = [0,0];
        var R = 414
            ,x = 0
            ,y =0
            ,theta =0
            ,thetaStep = 0.05
            ,xStep = 1
            ;
        var t = 0;
        var _run = function () {
            var aPath = [];
            if (t++ <= 200) {
                // x = R - (xStep*R)*Math.cos(theta);
                // y = R + (1.5*xStep*R)*Math.sin(theta);
                x = R - (R)*Math.cos(theta);
                y = 0 + (R)*Math.sin(theta);
                console.log(x,y) ;
                theta += thetaStep; 
                xStep += 0.05;
                if (theta > Math.PI*3/4) {
                    theta = 0;
                    if (xStep > 1.5 ) {
                        xStep = 1; 
                    }
                }
                var lGrd = me.c.createLinearGradient(0,0, 10, 2);  
                lGrd.addColorStop(0, '#ff0000');  
                lGrd.addColorStop(1, '#00f0ff');  
                me.c.strokeStyle = lGrd;  
                
                lastPoint = [x,y];
                newPoint = [lastPoint[0]+8, lastPoint[1]+4];

                aPath.push({type: 'moveTo', v: lastPoint}) ;
                aPath.push({type: 'lineTo', v: newPoint}) ;

                me.render(aPath);
                setTimeout(_run, 50);
            }
        };
        _run();
    };
    myCanvas.renderAnim();

</script>
</body>
</html>
