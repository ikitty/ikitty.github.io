<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<title>DEMO</title>
<style type="text/css" media="screen">
* {margin:0;padding:0;list-style:none;}
    
body {background-color:#000;}
.alex_line {display:block;margin:20px auto 0;width:414px;height:600px;background-image:url(http://ossweb-img.qq.com/images/n/act/a20151116show/mobile_bg.jpg);background-size:cover;border:1px solid #000;}
</style>
</head>
<body>


<canvas id="alexLine" class="alex_line"></canvas>

<script type="text/javascript">
    (function () {
        window.RAF= window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (cb) {
            window.setTimeout(cb, 1000/60);
        };
    })();

    var xLine = function () {
        this.init.apply(this, arguments);
    };  

    xLine.prototype = {
        config: {
            name:'alex'
            ,'age': 18
        }
        ,init: function (arg) {
            //动态在this上写入的对象是实例私有的，而this.config是指向prototype中的，各个实例共享

            //pre setting
            this.isNice = 1 ;
            this.isBeauty = 1 ;

            //custom config
            this.cfg = {};
            for (var i in arg) {
                if (arg.hasOwnProperty(i)) {
                    this.cfg[i] = arg[i];
                }
            }
        }
        ,say: function () {
            console.log(this.cfg) ;
        }
    };

    //Canvas Base Class
    var alexCanvas = function () { this.init.apply(this, arguments); };  
    alexCanvas.prototype = {
        init: function (arg) {
            this.c = null;

            //custom config
            this.cfg = {
                id: 'alexCanvas'
                ,width:200
                ,height:200
                ,lineCap: 'round'
                ,lineJoin: 'round'
                ,lineWidth: 3
                ,fillStyle: 'rgba(250, 0, 0, 0.8)'
                ,strokeStyle: 'rgba(180,180,180, 0.6)'
            };
            for (var i in arg) {
                if (arg.hasOwnProperty(i)) {
                    this.cfg[i] = arg[i] ;
                }
            }

            var D = this.cfg ;
            var el = document.getElementById(D.id);
            el.setAttribute('width', D.width) ;
            el.setAttribute('height', D.height) ;

            this.c = el.getContext('2d');
            this.setDrawStyle();
        }
        ,render: function (aPath) {
            var c = this.c ,
                me = this ;

            c.save();
            c.beginPath();  

            for (var i = 0, k = null; k = aPath[i] ; i++ ) {
                c[k.type] && (c[k.type].apply(c, k.v || []));
            }
            c.closePath();
            c.fill();         
            c.stroke();
            
            c.restore();
        }

        ,clear: function () {
            this.c.clearRect(0,0, this.cfg.width, this.cfg.height);
        }

        ,setDrawStyle: function (style) {
            style = style || {};
            var c = this.c ,
                config = this.cfg ;

            var styleArr = ['lineCap', 'lineJoin', 'lineWidth', 'fillStyle', 'strokeStyle'];
            for (var i = 0, k, le = styleArr.length ; i < le; i++ ) {
                k = styleArr[i];
                c[k] = style[k] || config[k] ;
            }
        }
    };

    //custom canvas
    var myCanvas = new alexCanvas({
        id: 'alexLine'
        ,width: 414
        ,height: 600
    });
    myCanvas.rand = function (min, max, digit) {
        var r = Math.random()*max + min ;
        return digit ? Number(r.toFixed(digit)) : (r | 0) ;
    };
    myCanvas.renderAnim = function () {
        var me =this;

        var lastPoint = [0,0];
        var R = 614
            ,x = 0
            ,y =0
            ,thetaOrigin = 0.1
            ,theta = thetaOrigin
            ,thetaStep = 0.01
            ,lineArr = new Array(5)
            ,lineColor = ['rgba(200,200,200,0.7)','rgba(50,200,255,0.5)','rgba(255,115,160,0.5)','rgba(115,255,200,0.7)','rgba(200,200,200,0.7)']
            ;
        var t = 0;
        var _run = function () {
            var aPath = [];
            if (t++ <= 1000) {

                me.clear();
                for (var i = 0, k, le = lineArr.length ; i < le; i++ ) {
                    k = lineArr[i];

                    x = R - 200- (R)*Math.cos(theta);
                    y = (-100) + (R)*Math.sin(theta);
                    theta += me.rand(thetaStep, thetaStep+0.15, 3); 
                    if (theta > Math.PI*2/4) {
                        theta = thetaOrigin ;
                    }
                    k = [x - (i*me.rand(10,30)), y + (i*me.rand(20,50))];
                    var newPoint = [k[0]+35, k[1]+16];
                    me.setDrawStyle({
                        strokeStyle: lineColor[i]
                        ,lineWidth: me.rand(1,2)
                    });
                    aPath.push({type: 'moveTo', v: k}) ;
                    aPath.push({type: 'lineTo', v: newPoint}) ;
                    me.render(aPath);
                }
                RAF(_run);
            }
        };
        _run();
    };
    myCanvas.renderAnim();

    /*
    myCanvas.render([
        {'type':'moveTo', v: [50, 50]}
        ,{'type':'lineTo', v: [100, 50]}
        ,{'type':'lineTo', v: [100, 100]}
        ,{'type':'moveTo', v: [150, 150]}
        ,{'type':'lineTo', v: [200, 200]}
    ]);
    */

</script>
</body>
</html>
